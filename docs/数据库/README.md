
# 数据库部分


## 市面主流数据库

### 为什么要使用数据库

**数据保存在内存**

​		优点： 存取速度快

​		缺点： 数据不能永久保存

**数据保存在文件**

​		优点：数据永久保存

​		缺点：速度比内存操作慢，频繁的IO操作。2）查询数据不方便

**数据保存在数据库**

1. 数据永久保存
2. 使用SQL语句，查询方便效率高。
3. 管理数据方便



### 什么是SQL？

结构化查询语言(Structured Query Language)简称SQL，是一种数据库查询语言。

作用：用于存取数据、查询、更新和管理关系数据库系统。



### MySql

#### 介绍

​		MySQL是一个关系型数据库管理系统，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一。

#### 特点

##### **优点**

1. 性能卓越，服务稳定，很少出现异常宕机；

2. 开放源代码无版本制约，自主性及使用成本低；

3. 历史悠久，社区和用户非常活跃，遇到问题及时寻求帮助；

4. 软件体积小，安装使用简单且易于维护，维护成本低；品牌口碑效应；

5. 支持多种OS，提供多种API接口，支持多种开发语言，对流行的PHP，Java很好的支持

#####  缺点

1. MySQL最大的缺点是其安全系统，主要是复杂而非标准，只有到调用mysqladmin来重读用户权限才会发生改变；
2. MySQL的另一个主要的途径之一是缺乏标准的RI（Referential  Integrity-RI）机制，RI限制的缺乏（在给定字段域上的一种固定的范围限制）可以通过大量的数据类型来补偿；
3. MySQL不支持热备份；
4. **MySQL对存储过程和触发器支持不够良好。**所以对于存储过程尽量避免使用

#### 应用场景

+ 数据之间存在关联性的场景，如电商系统等
+ 系统开源，中小型企业使用方便，性能优化方面需要用户对于Mysql有比较深的理解
+ GPL 协议不太方便用户二次开发

### Oracle

#### 特点

1. 兼容性：Oracle产品采用标准SQL，并经过美国u构架标准技术所（NIST）测试，与IBM  SQL/DS、DB2、INGRES、IDMS/R等兼容。

2. 可移植性：Oracle的产品可运行于很宽范围的硬件与操作系统平台上。可以安装在多种 大、中、小型机上，可在多种操作系统下工作。

3. 可联结性：Oracle能与多种通讯网络相连，支持各种协议。

4. 高生产率：Oracle产品提供了多种开发工具，能极大地方使用户进行进一步的开发。

5. 开放性：Oracle良好的兼容性、可移植性、可连接性和高生产率使Oracle   RDBMS具有良好的开放性。

**缺点**

1. 对硬件要求很高；
2. 价格比较昂贵；
3. 管理维护麻烦一些；
4. 操作比较复杂，需要技术含量高；

#### 特性

+ Oracle 属于大型数据库，并发性能会比较高，是更加专业性的商用数据库
+ Oracle 拥有更加成熟的性能调优工具
+ 由于是收费的系统，所以在出了问题之后，找官方客服即可

### Sql Server

#### 介绍

​		SQL Server 是Microsoft 公司推出的关系型数据库管理系统。具有使用方便可伸缩性好与相关软件集成程度高等优点，可跨越从运行Microsoft Windows 98 的膝上型电脑到运行Microsoft Windows 2012 的大型多处理器的服务器等多种平台使用。

#### 特点

##### 优点

1. 易用性、适合分布式组织的可伸缩性、用于决策支持的数据仓库功能、与许多其他服务器软件紧密关联的集成性、良好的性价比等；
2. 为数据管理与分析带来了灵活性，允许单位在快速变化的环境中从容响应，从而获得竞争优势。从数据管理和分析角度看，作为一个完备的数据库和数据分析包，SQLServer为快速开发新一代企业级商业应用程序。
3. 作为重要的基准测试可伸缩性和速度奖的记录保持者，SQLServer是一个具备完全Web支持的数据库产品，提供了对可扩展标记语言 (XML)的核心支持以及在Internet上和防火墙外进行查询的能力；

##### 缺点

1. SQL Server 只能windows上运行，WindowsX系列产品偏重于桌面应用，NT server只适合小型企业。
2. SQL server 并行实施和共存模型并成熟难处理日益增多用户数和数据卷伸缩性有限；
3. 没有获得任何安全证书。
4. SQL Server 多用户时性能佳。

###	PostgreSQL

#### 介绍

PostgreSQL是一个自由的对象-关系数据库服务器(数据库管理系统),支持大部分 SQL标准并且提供了许多其他现代特性：复杂查询、外键、触发器、视图、事务完整性、MVCC。同样，PostgreSQL 可以用许多方法扩展

#### 特点

##### 优点

1. PostgreSQL 是一个开源的，免费的，同时非常强大的关系型数据管理系统。
2. PostgreSQL 背后有热忱而经验丰富的社区，可以通过知识库和问答网站获取支持，全天候免费。
3. 即使其本身功能十分强大，PostgreSQL 仍附带有许多强大的开源第三方工具来辅助系统的设计、管理和使用。
4. 可以用预先存储的流程来程序性扩展 PostgreSQL ，一个高级的关系型数据库理应如此。
5. PostgreSQL 不只是一个关系型数据库，还是一个面向对象数据库——支持嵌套，及一些其他功能。

##### 缺点

1. 对于简单而繁重的读取操作, 超过了 PostgreSQL 的杀伤力，可能会出现比同行（如MySQL）更低的性能。
2. 按给出的该工具的性质，从普及度来说它还缺乏足够后台支撑，尽管有大量的部署——这可能会影响能够获得支持的容易程度。

#### 特性

+ 目前来说使用的人还不是很多，后台不太完善
+ 功能其他方面来说，与 MySql 不相上下
+ BSD 协议，完全免费，可二次开发，甚至收钱

### Mongodb

#### 介绍

是非关系型数据库(nosql ),属于文档型数据库。文档是mongoDB中数据的基本单元，类似关系数据库的行，多个键值对有序地放置在一起便是文档，语法有点类似javascript面向对象的查询语言，它是一个面向集合的，模式自由的文档型数据库。

+ 存储方式：虚拟内存+持久化。

+ 查询语句：是独特的Mongodb的查询方式。

+ 适合场景：事件的记录，内容管理或者博客平台等等。

+ 架构特点：可以通过副本集，以及分片来实现高可用。

+ 数据处理：数据是存储在硬盘上的，只不过需要经常读取的数据会被加载到内存中，将数据存储在物理内存中，从而达到高速读写。

+ 成熟度与广泛度：新兴数据库，成熟度较低，Nosql数据库中最为接近关系型数据库，比较完善的DB之一，适用人群不断在增长。

#### 特点

##### 优点

+ 快速！在适量级的内存的Mongodb的性能是非常迅速的，它将热数据存储在物理内存中，使得热数据的读写变得十分快。高扩展性，存储的数据格式是json格式！

##### 缺点

+ 不支持事务，而且开发文档不是很完全，完善。

#### 使用场景

+ 大数据领域，数据量大，但是数据的密度比较低
+ 数据之间的关联性比较低
+ 读写的频率相对比较高

#### 对比Msql

1. 如果需要将mongodb作为后端db来代替mysql使用，即这里mysql与mongodb 属于平行级别，那么，这样的使用可能有以下几种情况的考量： 
   1. mongodb所负责部分以文档形式存储，能够有较好的代码亲和性，json格式的直接写入方便。(如日志之类) 
   2. 从datamodels设计阶段就将原子性考虑于其中，无需事务之类的辅助。开发用如nodejs之类的语言来进行开发，对开发比较方便。 
   3. mongodb本身的failover机制，无需使用如MHA之类的方式实现。

2. 将mongodb作为类似redis ，memcache来做缓存db，为mysql提供服务，或是后端日志收集分析。 考虑到mongodb属于nosql型数据库，sql语句与数据结构不如mysql那么亲和 。



### Redis

#### 介绍

基于缓存，完成对于数据的快速读写

#### 应用场景

1. 读写的频率非常高，秒杀系统等

### ES

#### 介绍

搜索引擎

#### 应用场景

1. 适合数据量很大，查询比较频繁，但是修改比较少的情景，如百度百科的内容
2. 电商首页商品解锁



## 其他

### MongDB 对比 ES

#### 两者的定位

MongoDB和Elasticsearch都属于NoSQL大家族, 且都属于文档型数据存储，所以这两者的很多功能和特性高度重合, 但其实两者定位完全不同，MongoDB 是 文档型数据库, 提供 数据存储和管理服务，Elasticsearch 是搜索服务, 提供数据检索服务，两者的很大区别在于源数据的存储和管理

- MongoDB作为一个数据库产品, 是拥有源数据管理能力的
- Elasticsearch作为一个搜索引擎, 定位是提供数据检索服务, 也就是说我只管查, 不管写, Elasticsearch的Mapping不可变也是为此服务的, 带来的代价就是es不适合作为数据管理者, es可以从其他数据源同步数据过来提供查询, 但是不适合自己对数据进行存储和管理

es更侧重数据的查询, 各种复杂的花式查询支持的很好, 相比来说 MongoDB的查询能力就显得比较平庸了。由此可见, 对于个人, 如果你有一批数据要看, 但是不经常进行修改, 这个时候毫无疑问可以用es, 但是如果你还打算继续修改数据, 最好就是使用MongoDB，但其实对大多数人公司来讲，这两者的数据管理能力并没有多大的影响。**ES修改Mapping的代价非常高**, 所以我们一般都是把新数据重新写入一份新索引，然后直接切换读取的别名到新的索引

#### 两者读写数据的异同

1. MongoDB和ElasticSearch都支持全文索引, 虽然MongoDB的全文索引效果完全无法跟es相比(es毕竟是专业的搜索引擎产品, 着重提供数据的检所支持, 这方面吊打MongoDB也是可以理解的)
2. MongoDB虽然在支持的部分查询功能上稍微弱于es, 但是在大部分场景下性能方面完爆es, 不管是读性能, 还是写性能
3. es的写入延迟默认为1s, 这个虽然是写入延迟的范畴, 但是毫无疑问是一大缺点, 虽然可以配置为更短的时间, 但是这样就要牺牲一定的数据吞吐量, 会造成更频繁的磁盘刷新操作
4. es底层使用Lucene作为核心引擎, 很多es的设计就是为了匹配Lucene中的概念, 其实es可以看成一个lucene的proxy层包装,将lucene的原生接口封装的更好用, 同时还实现了很多管理和监控等辅助功能, 但是整体来说es上层的模块和lucene的隔阂还是挺明显的, 耦合度上有一定的欠缺
5. MongoDB则是完整的一个单体数据库产品, 虽然内部的存储引擎也是可插拔式的, 整体而言还是更加的浑然一体
6. MongoDB支持多种存储引擎, 本文所有涉及mongo存储引擎的只谈默认的WiredTiger引擎, 其实还有某些方面更优秀的其他引擎,例如: MongoRocks等

#### 部署和资源占用

1. 单机部署的话其实MongoDB和Elasticsearch都十分的方便, 不过es相对来说资源占用更多一点, 性能也比MongoDB要弱一点
2. 集群化的部署, 我们一般都会选择分片+副本的部署方式, 这种方式下, es部署起来比MongoDB方便太多, MongoDB要部署一套完整的分片 + 副本模式还是比较麻烦的, 没有经验的人部署起来需要一定的学习成本
3. 资源占用方面, MongoDB可以支持存储文件类型的数据, 作为数据库也有数据压缩能力, es则因为大量的索引存在需要占用大量的磁盘和内存空间

#### 可用性和容错

1. MongoDB和ElasticSearch作为天生分布式的代表产品都支持数据分片和副本
2. 两者都通过分片支持水平扩展, 同时都通过副本来支持高可用(HA)
3. 分片就是一个数据集的数据分为多份, 同时分布在多个节点上存储和管理, 主流分片方式有两种: hash分片和range分片, 两种分片方式各有优势, 适合不同的场景
4. 副本就是一份数据集同时有一个或者多个复制品(有些地方叫主从), 每份复制品都一模一样, 但是为了保证数据的一致性, 往往多个副本中只有一个作为Primary副本(通过选主算法从多个副本中选出Primary), 提供写服务, 其他副本只提供读, 或者只提供备份服务。（es和MongoDB都可以通过副本增强读能力, 这与kafka很不一样(kafka的副本只有备份功能)）

#### 适用场景

1. 类似场景
   1. 两者其实在很多使用场景上有重合之处, 是可以互相替代, 比如日志收集
2. 区别场景
   1. 但是某些方面两者又各有特色，比如： 如果打算使用一个文档型的业务数据库， 那最好还是选mongodb, 如果你有要求复杂查询又并发性能要求高的场景，类似搜索服务，那最好的选择是elasticsearch
   2. 除此之外：MongoDB有多个存储引擎可以选择, 而且MongoDB不仅看重数据的分析, 对数据的管理同样看重, 总的来说MongoDB更倾向于数据的存储和管理, 可以作为数据源对外提供， 未来说不定还会有支持join和支持倒排索引的mongo引擎出现
   3. Elasticsearch则有很多插件可以使用, 相对来讲Elasticsearch更倾向于数据的查询, 一般情况下elasticsearch仅作为数据检索服务和数据分析平台, 不直接作为源数据管理者
3. MongoDB适合
   1. 对服务可用性和一致性有高要求
   2. 无schema的数据存储 + 需要索引数据
   3. 高读写性能要求, 数据使用场景简单的海量数据场景
   4. 有热点数据, 有数据分片需求的数据存储
   5. 日志, html, 爬虫数据等半结构化或图片，视频等非结构化数据的存储
   6. 有js使用经验的人员(MongoDB内置操作语言为js)
4. Elasticsearch适合
   1. 已经有其他系统负责数据管理
   2. 对复杂场景下的查询需求，对查询性能有要求, 对写入及时性要求不高的场景
   3. 监控信息/日志信息检索
   4. 小团队但是有多语言服务，es拥有restful接口，用起来最方便

#### 总结

1. MongoDB和Elasticsearch都是我比较喜欢的存储产品
2. 两者的功能特性也存在很多重合的地方, 其实现在很多数据库产品都在互相借(chao)鉴(xi), 功能和特性都在逐渐变得相似, 这也是未来很多存储产品的发展趋势, 大家都希望自己能覆盖尽量多的场景和用户群体
3. 很多产品总是在不断的从没有->有->功能丰富,但是功能丰富一定是做了很多的妥协, 于是又有了 功能众多的单体服务->多个功能单一的子服务 方向的转变,就像三国里面说的 “天下大势, 分久必合合久必分”.
4. 现在NoSQL数据库产品就在这个路上, NoSQL归根到底都是 RDBMS的某个方面的妥协, 现在各种NoSQL 也都在加入对经典SQL和传统RDBMS的 join, 事务的支持, 但是我相信等到两者区别足够小的时候, 一定会有放弃了大而全, 而专注于某一场景的新的存储产品出现，到时候搞不好又是一波新的Nosql潮流
