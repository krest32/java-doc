# 通用系统设计

## 硬件开发环境

### 环境准备

+ dev-开发环境：供开发人员进行测试
+ test-测试环境：供测试人员进行测试
+ uat-预生产环境：环境代码基本与生产保持一致
+ prod-生产环境

说明：理论上来说代码运行环境起码需要有三套，如果有条件，环境可以部署四套更佳。当然一切需要以实际情况为主

### 服务器分类

+ 构建服务器：GitLab+Jenkins+harbor
+ 数据存储服务器： Mysql、PgSql、Orcal
+ 缓存服务器：Redis、ES等
+ 消息服务器：RabbitMQ、RocketMQ、Kafka
+ 后端应用服务器：Nginx
+ 前端应用服务器：Java、Go、C等应用

### 服务器配置

+ Jenkins服务器：8核+16G，测试环境构建频率频繁，推荐配置加倍
+ 数据存储服务器：测试环境推荐： 8核+16G ，生产环境 推荐：16核+32G
+ 缓存服务器：测试环境推荐：8核+16G，生产环境推荐：8核+32G
+ 应用服务器：测试环境推荐：8核+16G，生产环境推荐：16核+32G

以上服务仅仅是普通服务的推荐，具体情况需要具体分析。

## 软件环境准备

### Maven私服搭建

+ Nexus私服

### 持续集成环境搭建（推荐）

+ GitLab-私服代码仓库（推荐）
+ Jenkins-持续集成
+ Docker-镜像管理
+ Harbor-镜像仓库
+ Sonarqube-代码质量检测

### K8s环境（可选）

如果公司的服务的体量不是很大，更加推荐Jenkins+Docker的方式去实现

### 有状态服务软件

+ 数据持久化
  + Mysql（业务初期推荐）
  + PgSql
  + Orcal
+ 缓存
  + Redis
  + ES
+ 消息队列
  + RabbitMQ（界面会更加友好）
  + RockerMQ（性能更加卓越）
+ 超大大数据量
  + 分库分表中间件
    + Sharding-Proxy（推荐）
    + MyCat
  + 分布式数据库（推荐）
    + TiDB
    + OceanBase
  + NoSql
    + Hadoop+Hase
    + MongoDB
+ 对象存储
  + MinIO
  + 公有云服务商


### 服务集群监控（可选）

+ Prometheus+Grafana

## 微服务配套应用

### 注册中心

+ Nacos（推荐）
+ Eureka
+ Zookeeper

配置中心

+ Nacos（推荐）
+ Config

### 网关

+ Gateway

### 限流（可选）

+ Sentinel

### 链路追踪（可选）

+ Sleuth + Zipkin
+ Skywalking（推荐）
  + Mysql 
  + ES（推荐）

### 任务调度中心（可选）

+ XXL-job（推荐）

## 项目前期规划

### 代码架构

+ MVC 传统三层架构 （目前主流的代码架构，代码结构直观清晰）
+ DDD 领域驱动设计（如果系统架构比较复杂，推荐使用）

### 在线接口文档

+ 单体服务 -> Swagger
+ 微服务-> 网关 + Knife4j + Swagger

### 统一日志处理

+ 日志保存在服务器（小型系统推荐）
+ 日志保存在ES中（大型系统推荐）

### 代码规范的确认

+ 阿里巴巴代码规范（推荐）
+ 如有需要，也可以增加自定义代码规范

### 技术选型

+ 微服务架构
  + Spring Cloud（推荐）
  + Dubbo
+ ORM 框架
  + JPA
  + Mybatis-plus（推荐）
+ 配置数据加密：Jasypt

## 模块规划-基础版

### 描述：

基础版本的系统模块功能划分，如果需要特殊功能模块，可以在这其中进行追加，但是主要微服务不是划分的越细越好，任何规划都需要结合实际情况，尤其成本，好的设计需要兼顾成本、性能、扩展性

~~~
|---base-parent
|---base-code
|---base-module
|       |---entity
|       |---Dao
|       |---Constant
|---base-common
|---sys-integrate
|---sys-gateway
|---sys-eureka
|---sys-common
|       |---dict
|       |---file
|       |---email
|       |---log
|       |---other
|---biz-admin
|---biz-...
~~~

### base-parent

所有模块的父依赖，所有依赖的版本，所有模块必须导入

### base-code

可视化代码生成器

### base-module

+ entity 实体类与数据库的表字段一一对应
+ Dao 操作数据库的Dao接口
+ Constant 整个系统中系统常量

### base-common

项目基础工具包

### sys-integrate

所有的Feign调用接口，全部写入该模块中，该模块导入后，其他模块可以直接使用，进行Feign调用

### sys-gateway

网关

### sys-eureka

注册中心， 可以使用Nacos代替

### sys-common

公共服务，全系统公用，当然也可以把某一部分的代码独立出来行程一个单独的模块，此处并未强制性的要求

+ dicr 字典管理
+ file 文件处理
+ email 邮件管理
+ log 日志管理
+ 其他....

### biz-admin

+ 用户管理
+ 权限管理

### biz-...

实际的业务系统模块

## 性能要求

### 响应时间要求

### 可维护性要求

### 安全性要求

1. 系统仅限公司内部部分员工使用， 应接入使用公司统一身份认证管理系统，并通过权限设置严格控制系统的功能和数据使用；
2. 系统中涉及对公司重要业务信息和客户个人信息的操作、敏感操作均应记录详细日志，以备审计；个人敏感信息保护应满足全生命周期的合规安全要求，防止个人信息泄露；
3. 系统对可用性有一定要求，应根据业务需求和系统设计部署情况综合考虑灾备和应急方案的设计实施，包括数据灾备、应用主备等。
4. 如在测试期间需要从生产环境向测试环境同步数据，应进行必要的脱敏处理。
5. 系统上线前应开展并通过安全测试；
6. 后续如有第三方系统接入，应有防止非授权访问和保障数据安全性设计。

## 安全设计

### 身份认证

### 程序安全设计

1. 接口Https
2. 前端敏感数据加密
   1. 界面层在进行发送之前就已进行了加密处理。即使在页面开启F12的调试模式，在浏览器内看到这些敏感数据已经是被加密后的密文信息
   2. AES的方式进行加密时，对加密/解密的密码信息，前后端服务形成了一种“共识算法”的约定，从而杜绝AES密码在网络中传输的问题。
3. 后端敏感数据加密后持久化
4. 网关服务鉴权处理

## 压测

### Jmeter

